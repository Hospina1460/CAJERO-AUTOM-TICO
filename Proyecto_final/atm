#include <stdio.h>
#include <string.h>
#include <locale.h>

int main() {
    setlocale(LC_CTYPE, "Spanish");
    
    int opcion, intentos, i;
    float saldo = 5000.0;  // Saldo inicial
    float monto;
    
    // Arreglos para el sistema
    int cuentas_propias[3] = {1001, 1002, 1003};  // Cuentas del mismo banco
    float saldos_propias[3] = {5000.0, 3000.0, 7000.0};
    
    
    char bancos[3][20] = {"Banco General", "Banco Nacional", "Caja de Ahorros"};   
    char servicios[4][20] = {"Luz", "Agua", "Teléfono", "Internet"};
    
    int codigos_servicios[4] = {3001, 3002, 3003, 3004};
    
    char historial[20][60];  // Historial de transacciones
    int num_transacciones = 0;

    // Sistema de login
    printf("\n");
    printf("    CAJERO AUTOMÁTICO    \n");
    for(intentos = 1; intentos <= 3; intentos++) {
        int pin;
        printf("Ingrese su PIN: "); //Pin: 1234
        scanf("%d", &pin);
        
        if(pin == 1234) {
            printf("¡Login exitoso! Bienvenido.\n");
            break;
        } else {
            printf("PIN incorrecto. Intentos restantes: %d\n", 3 - intentos);
        }
        
        if(intentos == 3) {
            printf("Demasiados intentos fallidos. Saliendo...\n");
            return 0;
        }
    }

    // Menú principal
    while(1) {
        printf("\n    MENÚ PRINCIPAL    \n");
        printf("1. Consultar saldo\n");
        printf("2. Retirar efectivo\n");
        printf("3. Depositar efectivo\n");
        printf("4. Transferencia entre cuentas propias\n");
        printf("5. Transferencia a otros bancos\n");
        printf("6. Pagar servicios\n");
        printf("7. Ver historial de transacciones\n");
        printf("8. Salir\n");
        printf("Seleccione una opción: ");
        scanf("%d", &opcion);

        switch(opcion) {
            case 1:  // Consultar saldo
                printf("\n    CONSULTA DE SALDO    \n");
                printf("Su saldo actual es: $%.2f\n", saldo);
                
                // Registrar en historial
                if(num_transacciones < 20) {
                    sprintf(historial[num_transacciones], "Consulta de saldo: $%.2f", saldo);
                    num_transacciones++;
                }
                break;

            case 2:  // Retirar efectivo
            {
                printf("\n    RETIRO DE EFECTIVO    \n");
                printf("Su saldo actual: $%.2f\n", saldo);
                printf("Ingrese el monto a retirar: ");
                scanf("%f", &monto);
                
                if(monto <= 0) {
                    printf("Error: El monto debe ser positivo.\n");
                } else if(monto > saldo) {
                    printf("Error: Saldo insuficiente.\n");
                } else {
                    saldo -= monto;
                    printf("Retiro exitoso. Nuevo saldo: $%.2f\n", saldo);
                    
                    // Registrar en historial
                    if(num_transacciones < 20) {
                        sprintf(historial[num_transacciones], "Retiro: -$%.2f | Saldo: $%.2f", monto, saldo);
                        num_transacciones++;
                    }
                }
            }
            break;

            case 3:  // Depositar efectivo
            {
                printf("\n    DEPÓSITO DE EFECTIVO    \n");
                printf("Su saldo actual: $%.2f\n", saldo);
                printf("Ingrese el monto a depositar: ");
                scanf("%f", &monto);
                
                if(monto <= 0) {
                    printf("Error: El monto debe ser positivo.\n");
                } else {
                    saldo += monto;
                    printf("Depósito exitoso. Nuevo saldo: $%.2f\n", saldo);
                    
                    // Registrar en historial
                    if(num_transacciones < 20) {
                        sprintf(historial[num_transacciones], "Depósito: +$%.2f | Saldo: $%.2f", monto, saldo);
                        num_transacciones++;
                    }
                }
            }
            break;

            case 4:  // Transferencia entre cuentas propias
            {
                printf("\n    TRANSFERENCIA ENTRE CUENTAS PROPIAS    \n");
                printf("Cuentas disponibles:\n");
                for(i = 0; i < 3; i++) {
                    printf("%d. Cuenta %d - Saldo: $%.2f\n", i+1, cuentas_propias[i], saldos_propias[i]);
                }
                
                int opcion_cuenta;
                printf("Seleccione la cuenta destino (1-3): ");
                scanf("%d", &opcion_cuenta);
                
                if(opcion_cuenta < 1 || opcion_cuenta > 3) {
                    printf("Error: Opción no válida.\n");
                    break;
                }
                
                int cuenta_destino = opcion_cuenta - 1;
                printf("Ingrese el monto a transferir: ");
                scanf("%f", &monto);
                
                if(monto <= 0) {
                    printf("Error: El monto debe ser positivo.\n");
                } else if(monto > saldo) {
                    printf("Error: Saldo insuficiente.\n");
                } else {
                    saldo -= monto;
                    saldos_propias[cuenta_destino] += monto;
                    printf("Transferencia exitosa a cuenta %d.\n", cuentas_propias[cuenta_destino]);
                    printf("Su nuevo saldo: $%.2f\n", saldo);
                    
                    // Registrar en historial
                    if(num_transacciones < 20) {
                        sprintf(historial[num_transacciones], "Transferencia a cuenta %d: -$%.2f", cuentas_propias[cuenta_destino], monto);
                        num_transacciones++;
                    }
                }
            }
            break;

            case 5:  // Transferencia a otros bancos
            {
                printf("\n    TRANSFERENCIA A OTROS BANCOS    \n");
                printf("Bancos disponibles:\n");
                for(i = 0; i < 3; i++) {
                    printf("%d. %s\n", i+1, bancos[i]);
                }
                
                int opcion_banco;
                printf("Seleccione el banco destino (1-3): ");
                scanf("%d", &opcion_banco);
                
                if(opcion_banco < 1 || opcion_banco > 3) {
                    printf("Error: Opción no válida.\n");
                    break;
                }
                
                int cuenta_destino;
                printf("Ingrese el número de cuenta destino: ");
                scanf("%d", &cuenta_destino);
                
                // Opcional: evitar transferir a cuentas propias por error
                int es_cuenta_propia = 0;
                for(i = 0; i < 3; i++) {
                    if(cuenta_destino == cuentas_propias[i]) {
                        es_cuenta_propia = 1;
                        break;
                    }
                }
                if(es_cuenta_propia) {
                    printf("Advertencia: %d es una cuenta propia.\n", cuenta_destino);
                    printf("Use la opción 4 para transferencias internas (sin comisión).\n");
                    break;
                }
                
                printf("Ingrese el monto a transferir: ");
                scanf("%f", &monto);
                
                if(monto <= 0) {
                    printf("Error: El monto debe ser positivo.\n");
                } else if(monto > saldo) {
                    printf("Error: Saldo insuficiente.\n");
                } else {
                    float comision = monto * 0.02;
                    if(saldo < monto + comision) {
                        printf("Error: Saldo insuficiente para cubrir monto + comisión ($%.2f).\n", comision);
                        break;
                    }
                    saldo -= (monto + comision);
                    printf("Transferencia exitosa\n");
                    printf("Banco: %s\n", bancos[opcion_banco - 1]);
                    printf("Cuenta destino: %d\n", cuenta_destino);
                    printf("Monto transferido: $%.2f\n", monto);
                    printf("Comisión (2%%): $%.2f\n", comision);
                    printf("Nuevo saldo: $%.2f\n", saldo);
                    
                    // Registrar en historial con banco y cuenta reales
                    if(num_transacciones < 20) {
                        sprintf(historial[num_transacciones], 
                                "Transf. a %s Cta.%d: -$%.2f (Com. $%.2f)", 
                                bancos[opcion_banco - 1], 
                                cuenta_destino, 
                                monto, 
                                comision);
                        num_transacciones++;
                    }
                }
            }
            break;

            case 6:  // Pagar servicios
            {
                printf("\n    PAGO DE SERVICIOS    \n");
                printf("Servicios disponibles:\n");
                for(i = 0; i < 4; i++) {
                    printf("%d. %s\n", i+1, servicios[i]);
                }
                
                int opcion_servicio;
                printf("Seleccione el servicio a pagar (1-4): ");
                scanf("%d", &opcion_servicio);
                
                if(opcion_servicio < 1 || opcion_servicio > 4) {
                    printf("Error: Opción no válida.\n");
                    break;
                }
                
                int servicio = opcion_servicio - 1;
                printf("Ingrese el monto a pagar: ");
                scanf("%f", &monto);
                
                if(monto <= 0) {
                    printf("Error: El monto debe ser positivo.\n");
                } else if(monto > saldo) {
                    printf("Error: Saldo insuficiente.\n");
                } else {
                    saldo -= monto;
                    printf("Pago exitoso de %s.\n", servicios[servicio]);
                    printf("Monto pagado: $%.2f\n", monto);
                    printf("Su nuevo saldo: $%.2f\n", saldo);
                    
                    // Registrar en historial
                    if(num_transacciones < 20) {
                        sprintf(historial[num_transacciones], "Pago de %s: -$%.2f", servicios[servicio], monto);
                        num_transacciones++;
                    }
                }
            }
            break;

            case 7:  // Ver historial de transacciones
                printf("\n    HISTORIAL DE TRANSACCIONES    \n");
                if(num_transacciones == 0) {
                    printf("No hay transacciones registradas.\n");
                } else {
                    printf("Últimas transacciones:\n");
                    for(i = 0; i < num_transacciones; i++) {
                        printf("%d. %s\n", i + 1, historial[i]);
                    }
                }
                break;

            case 8:  // Salir
                printf("\nGracias por usar nuestro cajero automático. ¡Hasta pronto!\n");
                return 0;

            default:
                printf("Error: Opción no válida. Intente nuevamente.\n");
        }
    }

    return 0;
}
